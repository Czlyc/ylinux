{% extends 'wiki/base.html' %}

{% block extend_header %}
{% if theme %}
<link rel="stylesheet" href="{{ MEDIA_URL }}themes/{{ theme }}/main.css" />
<link rel="stylesheet" href="{{ MEDIA_URL }}themes/{{ theme }}/wiki_index.css" />
{% else %}
<link rel="stylesheet" href="{{ MEDIA_URL }}themes/default/main.css" />
<link rel="stylesheet" href="{{ MEDIA_URL }}themes/default/wiki_index.css" />
{% endif %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/ylinux.js" ></script>
{% endblock %}


{% block header %}

<div id="logo"><a href="/"><img src="{{ MEDIA_URL }}images/ylinux-logo.gif" alt="YLinux"/></a></div>
<div id="welcome"><span>我们不只关注 GNU/Linux ！</span></div>

<div class="right">

  <div id="navigator">
    <a href="/wiki/topic/news/"><img src="{{ MEDIA_URL }}images/feed.gif" alt="订阅最近动态"/></a>
    <span>
      <a href="/">首页</a>
      <a href="/coding">新闻</a>
      <a href="/bbs">论坛</a>
      <a href="/blog">博客</a>
      <a href="/coding">项目</a>
      <a href="/wiki">知识库</a>
    </span>
  </div>

  <div id="account">
    {% if user.is_authenticated %}
    欢迎回来，<a href="{% url account:show_user user.id %}"><b>{{ user }}</a></b>
    {% if user.is_staff %} | <a href="{% url admin:index %}">管理界面</a> | {% endif %}
    <span id="logout"><button type="button" onclick="javascript: ajax_logout()">退出</button></span>
    {% else %}
    <!--<a href="{% url account:login %}">登录</a> <a href="{% url account:register %}"><b>注册</b></a>-->
    <span id="login"><button type="button" onclick="javascript: ajax_create_login()">登录</button></span>
    <span id="register"><button type="button">注册</button></span>
    {% endif %}
  </div>

</div>

{% endblock %}


{% block content %}

<script type="text/javascript">

    $(document).ready( function () {

        $("#cmenu > ul:not(:first)").hide();
        $("#cmenu > ul:first ul").hide();

        $("#cmenu > li").addClass("cmenu-li");
        $("#cmenu > ul > li").addClass("cmenu-ul-li");
        $("#cmenu > ul > ul > li").addClass("cmenu-ul-ul-li");

        $("#cmenu li").click( function () {

            $(".catalog-selected").removeClass("catalog-selected");
            $(this).removeClass("background");
            $(this).addClass("catalog-selected");

            $(this).next("ul").slideToggle("200");

            return false;

        });

        // 显示更新信息
        $("#wiki-container-main").load("{% url wiki:ajax_show_update %}", function () {
            $(this).addClass("list-catalog-done");
        });

        // 定时刷新
        set_wiki_update("{{ lastUpdataTime }}");


    });

</script>

  <div id="tools" class="clearfix">
    <form method="get" action="http://www.google.com/search" target="google_window">
      <input type="text" name="as_q" size="16" maxlength="255" value="" id="s"/>
      <input type="image" src="/ymedia/images/btn_search_box.gif" width="27" height="24" id="go" alt="Search" title="Search" />
      <!--<input type="submit" name="sa" value="搜索"/>-->
      <input name="as_sitesearch" value="ylinux.org" type="hidden"/>
      <input name="newwindow" value="1" type="hidden"/>
      <input name="complete" value="1" type="hidden"/>
      <input name="forid" value="zh-CN" type="hidden"/>
      <input type="hidden" name="num" value="10"/>
      <input name="btnG" value="Google+%E6%90%9C%E7%B4%A2&" type="hidden"/>
      <input name="as_ft" value="1" type="hidden"/>
      <input name="as_qdr" value="all" type="hidden"/>
      <input name="as_occt" value="any" type="hidden"/>
      <input name="as_dt" value="i" type="hidden"/>
    </form>
  </div>

<div id="wiki-update">
</div>
<div id="wiki-container" class="clearfix">

  <div id="wiki-container-catalog" class="clearfix">
    {% if catalogs %}
    <ul id="cmenu">
      {% for l0 in catalogs %}
      <li class="catalog-link" class="catalog-level0" {% if l0.children %}class="have-subcatalog"{% endif %} onclick="ajax_list_catalog('{% url wiki:ajax_show_catalog l0.id %}')">{{ l0 }}</li>
      {% if l0.children %}
      <ul>
        {% for l1 in l0.children %}
        <li class="catalog-link" class="catalog-level1" {% if l1.children %}class="have-subcatalog"{% endif %} onclick="ajax_list_catalog('{% url wiki:ajax_show_catalog l1.id %}')">{{ l1 }}</li>
        {% if l1.children %}
        <ul>
          {% for l2 in l1.children %}
          <li class="catalog-link" class="catalog-level2" {% if l2.children %}class="have-subcatalog"{% endif %} onclick="ajax_list_catalog('{% url wiki:ajax_show_catalog l2.id %}')">{{ l2 }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% endfor %}
      </ul>
      {% endif %}
      {% endfor %}
    </ul>
    {% endif %}
  </div>

  <div id="wiki-container-main">
  </div>

</div>


{% endblock %}
